<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd"
    >
<html lang="en">
<head>
	<title>Sample spreadsheet better practices</title>

<style>
body {background-color: white; color: black;margin-left: 200px; margin-right:200px; margin-top: 50px; margin-bottom: 100px; text-align: justify; line-height:1.4;}


	hr {display: block; margin-top: 1em; margin-bottom: 1em; margin-left: auto; margin-right: auto; border-style: inset; border-width: 2px;} 
	
	#maincontainer{
	width: 1000px;
	}
	
	.imagecontainer {
    position: relative;
    text-align: center;
    color: white;
}

/* Bottom left text */

.circleborder {
    position: absolute;
	font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;
	font-weight: 900;	
	width: 40px;
    line-height: 40px;
    border-radius: 50%;
    text-align: center;
    font-size: 32px;
    
}

.errorclass{
	color: red;
	border: 5px solid red;
}

.fixedclass{
	color: green;
	border: 5px solid green;
}
</style>


</head>

<body>
<div id="maincontainer">
    <h1><center>Better practices for sample spreadsheet creation</center></h1>
	
	<p>
	<b>Target audience:</b> Researchers who frequently create spreadsheet files, typically "the biologist".  
	</p>
    <p><b>Aim:</b> Help the biologist in the future make better informed decisions when creating spreadsheet files.
    </p>
    
   <h2><center>tl;dr (we need a better title here)</center></h2> 
    <ul>
    <li><b>File names:</b> File names should only contain letters and numbers, and no blank spaces. The exception are hyphens &#8208; or underscores _, which can substitute for the blank spaces. Names of related files should be consistent. <a href="#namingvariables">Read more about naming</a></li> 
	<li><b>Columns names:</b> Column names should not contain any characters apart from letters, numbers or underscores _ . Related columns should have consistent names. <a href="#namingvariables">Read more about naming</a></li>	   
	<li><b>Sample identifiers:</b> Identifiers should start with a letter, and numbers within them should have the same number of digits. <a href="#namingvariables">Read more about naming</a></li> 
	<li><b>Formatted information:</b> The spreadsheet should never use formatting to store information (f. ex. colour or position). Besides, blank cells should be avoided. <a href="#information">Read more about storing information</a></li>
	<li><b>Date format: </b> Date format should be consistent along the spreadsheet. It is strongly recomended to use the format YYYY-MM-DD. <a href="#dates">Read more about dates</a></li>   
    </ul>
	<br/>

    <h2><center>Introduction</center></h2>
    
    <p>
    
    Spreadsheets often need to be read and understood by both other humans than the biologist and computer programs used for data analysis. It may not be a topic many biologists pay a lot of attention to, but unfortunate choices in the initial creation of the spreadsheet may later give opportunities for mistakes to be made in the analysis. In addition, it usually means that a significant amount of time must be used in back-and-forth messages between the biologist and the bioinformatician to clear out ambiguities. For those who know how to do it, generating a good spreadsheet is not a difficult task and it can save a lot of valuable time later.</p>
    
    <p>   
    This guide focuses on the creation of tidy spreadsheets that are less error-prone and easier for computers to process, although they may seem slightly less pleasant to the human eye. If you need to show your data in a presentation, you should make a pretty ad-hoc version but keep the main file computer-friendly.
    </p>
    <p>    
    We hope that the following advices help the biologist realize which practices are best avoided, understand why they are problematic and learn how to fix them. At the same time, we acknowledge that some of the "unfortunate" practices have value for the biologist and will be continued, but now after a better informed decision.</p> 


<br/>
<br/>
<br/>

    
    <h2><center>A practical example: "the Spreadsheet File from Hell"</center></h2>
    
    <p>In this illustration we have collected examples of the most common problematic practices (highlighted with red numbers) to a create a spreadsheet that would be the nightmare of any data analyst. Below you can find a list with 
    the corresponding problems and some recommendations on how to fix them. You can click on the <q>Read more</q> options to get an extended explanation. Under the list you can see how the spreadsheet looks after we have applied the better practices.</p>
    <br/>
    
     
    <center>
    
    <div  class="imagecontainer" style="width: 1000px;">
    <!-- div and img width must be the same in order for positioning to work-->
    <img src="images/sample_annotation_better_practice/sample_annotation_file_from_hell.png" width=1000>
    <!-- Real width of image was aprrox 2200px-->
    
    <div class="circleborder errorclass" style="bottom: 95%;left: 30%;" title="Weird file name">1</div>
    <div class="circleborder errorclass" style="bottom: 77%;left: 23%;" title="Weird column names">2</div>
    <div class="circleborder errorclass" style="bottom: 77%;left: 52%;" title="Weird column names">2</div>
    <div class="circleborder errorclass" style="bottom: 77%;left: 65%;" title="Long column names">3</div>
    <div class="circleborder errorclass" style="bottom: 63%;left: 7%;" title="Inconsistent sample identifiers">4</div>
    <div class="circleborder errorclass" style="bottom: 47%;left: 15%;" title="None-categorical categorical variables">5</div>
    <div class="circleborder errorclass" style="bottom: 67%;left: 64%;" title="Decimal variability">6</div>
    <div class="circleborder errorclass" style="bottom: 73%;left: 0%;" title="Information in formatting">7</div>
    <div class="circleborder errorclass" style="bottom: 40%;left: 0%;" title="Information in formatting">7</div>
    <div class="circleborder errorclass" style="bottom: 50%;left: 27%;" title="Information in formatting">7</div>
    <div class="circleborder errorclass" style="bottom: 22%;left: 65%;" title="Horror vacui">8</div>
    <div class="circleborder errorclass" style="bottom: 18%;left: 24%;" title="Numbers are numbers">9</div>
    <div class="circleborder errorclass" style="bottom: 25%;left: 82%;" title="Impractical date format">10</div>
	<div class="circleborder errorclass" style="bottom: 85%;left: 25%;" title="Merged cells">11</div>
	<div class="circleborder errorclass" style="bottom: 77%;left: 44%;" title="Anglophobia">12</div>
    </div>
    <p><center>Information contained in this image has been made up for this example and it does not reflect any data from real patients.</center> </p>
    </br>
    
    <h2>Which problems do we find in this spreadsheet? And how can we solve them?</h2></center>
    <ol type="1">
    
        <li><b>Weird file name:</b> File name contains blank spaces.  It is a good practice to substitute blank spaces with a hyphen &#8208; or an underscore _.
	<a href="#namingvariables">Read more about naming</a></li>
	
	<li><b>Weird column names:</b> Several variable names have blank spaces, newline and/or special characters (beware of Norwegian characters!). It can cause problems when a different program reads those columns. Blank spaces can be substituted with an underscore _. It is also recommended not to use capitals in column names to prevent spelling mistakes. <a href="#namingvariables">Read more about naming</a></li>
	
	<li><b>Long column names:</b> Having short and meaningful column names helps to work with the data. If several columns refer to related information (for example different time points), they should have consistent names. Additional information about the variable (description, units...) can be kept in a separate data dictionary. <a href="#namingvariables">Read more about naming</a></li>
	
        <li><b>Inconsistent sample identifiers:</b> Some of the identifiers start with numbers and some with letters, and some use dots to separate the groups of numbers while others use underscores. Besides,
	theses numbers have different amounts of digits. This lacking of consistency could lead to problems if the individuals are sorted by their identifiers. <a href="#consistency">Read more about consistency</a>
	<a href="#namingvalues">Read more about naming</a></li>
	
        <li><b>None-categorical categorical variables:</b> The disease variable has only two options: <q>control</q> and <q>case</q>, but these values are written in several different ways, which could be interpreted by a
        program as different conditions. <a href="#consistency">Read more about consistency</a></li>
        
        <li><b>Decimal variability:</b> The numeric columns show values with a different number of decimals. <a href="#consistency">Read more about consistency</a></li>
        
       <li><b>Information in formatting:</b> The information about the type of sickness (DCIS or benign) is codified by their position in the spreadsheet. There are also some samples with odd problems
	shown in green and special cases marked with an asterisk. It is better to store this data in new variables. <a href="#information">Read more about storing information</a></li>
	
        <li><b>Horror vacui:</b> Some programs throw mistakes when they read a column with blank spaces. It is better to replace all of them with <q>NA</q>, which is universally recognized as an empty value.
	<a href="#information">Read more about storing information</a></li>
	
	<li><b>Numbers are numbers:</b> Column <q>CD4-/CD8-</q> shows two values as <q>&lt;0.6</q>. Numeric columns should not include non-numeric symbols and specific comments can be stored in an extra <q>Comments</q> column.
	<a href="#information">Read more about storing information</a></li>
	
        <li><b>Impractical date format:</b> The dates have different formats, and one of the cell shows extra information. The recommended format is YYYY-MM-DD and the extra information can be included in the <q>Comments</q>
	column. <a href="#dates">Read more about dates</a></li>
	
	<li><b>Merged cells:</b> Several cells have been merged into a single one. This kind of changes in the structure of the spreadsheet should be completely avoided. <a href="#structure">Read more about structure</a></li>
	
		<li><b>Anglo-phobia:</b> Some columns have norwegian names. If the ambition is to make a publication in an international journal from the study, this must be translated to English. <a href="#language">Read more about language</a></li>
    </ol>
    <p>This is how the spreadsheet looks after the modifications. We have highlighted the columns or cells modified or added to the previous table:</p>
    <br/>
    
    
    <div  class="imagecontainer" style="width: 1000px;">
    <!-- div and img width must be the same in order for positioning to work-->
    <img src="images/sample_annotation_better_practice/sample_annotation_tidy.png" width= 1000>
    
    <div class="circleborder fixedclass" style="bottom: 95%;left: 35%;" title="Fixed Weird file name">1</div>
    <div class="circleborder fixedclass" style="bottom: 81%;left: 20%;" title="Fixed Weird column names">2</div>
    <div class="circleborder fixedclass" style="bottom: 81%;left: 60%;" title="Fixed Weird column names">2</div>
    <div class="circleborder fixedclass" style="bottom: 81%;left: 68%;" title="Fixed Long column names">3</div>
    <div class="circleborder fixedclass" style="bottom: 50%;left:  4%;" title="Fixed Inconsistent sample identifiers">4</div>
    <div class="circleborder fixedclass" style="bottom: 47%;left: 15%;" title="Fixed None-categorical categorical variables">5</div>
    <div class="circleborder fixedclass" style="bottom: 67%;left: 64%;" title="Fixed Decimal variability">6</div>
    <div class="circleborder fixedclass" style="bottom: 37%;left: 9%;" title="Fixed Information in formatting">7</div>
    <div class="circleborder fixedclass" style="bottom: 37%;left: 27%;" title="Fixed Information in formatting">7</div>
    <div class="circleborder fixedclass" style="bottom: 23%;left: 67%;" title="Fixed Horror vacui">8</div>
    <div class="circleborder fixedclass" style="bottom: 19%;left: 20%;" title="Fixed Numbers are numbers">9</div>
    <div class="circleborder fixedclass" style="bottom: 25%;left: 78%;" title="Fixed Impractical date format">10</div>
	<div class="circleborder fixedclass" style="bottom: 75%;left: 50%;" title="Fixed Anglophobia">12</div>
	
    </div>
    <br/>
    <br/>
    <br/>
    <br/>
    <h2><center>General concepts</center></h2>
    <br/>
     
    <a name="namingvariables"><h4>Naming of files and variables</h4></a>
    
    <p>It is important that the file can be read by most programs. Thus, file names should not have any characters apart from letters and numbers, with the exception of
    hyphens &#8208; or underscores _. Blank spaces can create problems when the data file is read by some computer programs, especially bioinformatic programs which often are not very robust for unexpected input. Instead you can separate the words using hyphens or underscores. If you never use capital letters, a lot of spelling mistakes will be avoided. These advices apply also to column names (variables), since they may end up in file names as plots and tables. In addition variables may be used in the analysis as part of mathematical formulas where a lot of characters, like minus or plus, have a special meaning. All special characters are therefore best avoided in variable names, with the exception of underscore which has no known alternative interpretation.</p>
     <br/>
    <a name="namingvalues"><h4>Naming of Ids and values</h4></a>
    <p>Identification numbers for the samples should have the same number of digits. This is critical in order to prevent mistakes when sorting, as sometimes this field is treated as text and then <q>1000</q> would
    go before <q>20</q>. These identifiers should start with a letter, as some programs may remove the zeros at the left of a numeric value. For instance if you have 20 samples, it is better to give them ids like "s01", "s02" ... than just numbering them 1-20. The main concept here is that the <a href="https://en.wikipedia.org/wiki/Lexicographical_order">alphabetical sort order</a> should be sensible and identical to what a numeric sort order would be (if possible). For instance the common naming of chromosomes, "chr1", "chr2".. violates this and dumb programs (which there are a lot of) would put "chr10" immediately after  "chr1". In addition, sample IDs often end up as part of file names and should therefore ideally follow the same principles, i.e no special characters</p>
    <p>Categorical values with no meaningful numeric or rank interpretation should be written in a format which makes it impossible for a program to interpret it in a numerical sense. For instance, if patients are given pure numbers as identifiers then some programs may interpret patient "4" to be twice as much patient as patient "2". This will be avoided by calling the patients "p4" and "p2". In some situations categorical values can also have a natural rank, for instance the cancer stage "4" is not twice as much cancer as "2", but it is more severe and in some analysis this rank order is utilized. However, when in doubt what analysis will be done later, try to enforce the non-numeric interpretation, i.e use "stage2" and "stage4" for cancer stages.</p>
      
      <br/>
      
    <a name="information"><h4>Storing information</h4></a>
	
    <p>You have to be aware that any kind of information in formatting, like encoding data with different colour or font, may get lost when the spreadsheet is read by a different program than the one used to create it.  Few bioinformatics programs knows how to interpret excel formatting. This information should instead be encoded in a new variable. Ideally the file should be in a simple text format as csv or tab-text, since this is the format most bioinformatics programs understand. You may still use an excel-like format as long as no important information is lost and the column-row connection is kept when saving as cvs.</p>
    <p>
    Each cell should contain only one piece of information. For example, the column <q>plate_well</q>
    with a value of "plate07-B03" it is better registered as two or three different columns: <q>plate</q> with the value plate07 and <q>well</q> with the value B03 or even split in B and 3. </p> 
    <p>Several functions in different programs throw errors when they find a blank cell. Avoid blank cells in your spreadsheet by registering missing data with a non-numeric value which is consistent across the table.
    The value <q>NA</q> is widely used and can be recognized by several programs. In addition the biologist sometimes forget to fill in a value. If a blank cell means missing data, it will create an ambiguity and the bioinformatician can not know if it means "no measurement available" or "the biologist forgot to enter the measurement". If the biologist actively denotes an unavailable value as such with NA, then the bioinformatician will correctly interpret the empty cell as a mistake and get it sorted out.
    <p>When using a numeric variable, do not write any symbol apart from numeric characters in the cells. Including any other symbol can result in the program considering the values in that column as text instead of numbers and subsequent
    calculation would fail. If you need to make a note about an specific cell, use an extra  <q>Comments</q> column. </p>
     
     <br/>
     
     
    <a name="consistency"><h4>Consistency</h4></a>
    
    <p>Being consistent is one of the most important things when creating a spreadsheet. A consistent spreadsheet is much easier to read and understand by others and it can save hours of delay while the bioinformatician and the biologist
    exchange questions and answers about the data file. For example, using <q>Dopamine10weeks</q> and <q>dop_20w</q> as column names in the same spreadsheet can be confusing and lead to an avoidable waste of time until all the
    doubts are answered. Try to use short and meaningful names for your columns and a consistent structure for their names. The same principle applies to identification names. Having several samples labeled as <q>Rat1</q>, <q>R2</q>
    and <q>rat_3</q> is unnecessarily confusing. And be aware that consistency is specially critical when you are using categorical variables: <q>male</q>, <q>Male</q> and <q>M</q> may mean the same to a human eye, but they are
    certainly not the same to a program.</p>
    <p>It is not only important to be consistent within a certain spreadsheet, but also among your different files. If you have several spreadsheets with the same information (for example same experiment at different time points),
    use the same layout. If you have several files that are related, use consistent names. </p>   
     
     
     <br/>
         
    <a name="dates"><h4>Dates</h4></a>
    
    <p>Dates can be the source of several problems if they are stored in different formats. Although Excel can recognize most of the different formats as dates and sort them accordingly, other programs may treat them as text and sort them alphabetically.
    Thus, it is important to use the order year-month-day with zero-padding to force the alphabetical sort order to also be chronological. In addition, local conventions of the month and day order may vary. One easy way to avoid problems is to routinely use the <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> standard YYYY-MM-DD everywhere. </p>
    
    <br/>
    
    
    <a name="structure"><h4>Structure</h4></a>
    
    <p>Each spreadsheet should contain only one rectangular table where rows are the samples and columns are the values. There should never be merged cells in your spreadsheet, as it can create a huge mess when
    the spreadsheet is read by a different program.</p>
    <p>Sometimes it could be wise to split the information into separate files. For instance if you have several samples for each patients as in a time series, you could have patient information in one file (disease, age, sex etc) and sample related information (date of sample, dosage etc) in another file. But remember to use consistent identifiers so the connection is not lost. This is the way data is organized in relational databases.</p>
    <p>It is important that your data file contains only raw data and you do not modify it after is has been created. Any kind of modification applied to your data file, like using calculations and formulas, can lead to
    undesired data manipulation. If you need to apply any calculation to your data, use a duplicate file. It is also recommended to avoid having information about the data in the spreadsheet. A good practice is to have in
    a separate file a data dictionary that can contain variable description, units, etc.</p>

    <br/>
    
    <a name="language"><h4>Language</h4></a>    
    <p>
    	Most biologists want their study to be published in an international journal. Therefore, the information in the sample spreadsheet needs to be in English even though the biologist might speak a different language. The best point in time to do the translation is right at the start when the file is created. Postponing this will often lead to extra work, since the variable names and values may be embedded in tables and plots.
    </p>
    <br/>
    
    <hr>
    <br/>
    <br/>    
    
    <a name="structure"><h4>Further reading</h4></a>
    
    <br/>
	
    <p>Some of the information reflected in this guide comes from 
    <br/>
    <pre>
    Karl W. Broman & Kara H. Woo (2017)<a href="https://www.tandfonline.com/doi/full/10.1080/00031305.2017.1375989"> Data Organization in Spreadsheets</a>
    The American Statistician, 72:1, 2-10, DOI: 10.1080/00031305.2017.1375989
   </pre>
   <br/>
   <p>
   In this paper you can find additional information,
    a extended explanation of the typical mistakes and lots of good examples. We encourage everyone to read it.</p>
    
    <BR/>
<BR/>

    <p>Data Carpentry has an <a href="http://www.datacarpentry.org/spreadsheet-ecology-lesson/">online tutorial</a> about data organization in spreadsheets with several exercises. It contains
    notes for instructors who wish to use it for a small workshop or presentation. 
    
<BR/>
<BR/>
Files used: <br/>
<a href="Sample%20annotation%20File%20from%20Hell.xls">Sample annotation File from Hell.xls</a><br/>
<a href="sample_annotation_tidy.csv">sample_annotation_tidy.csv</a><br/>
<BR/>
<BR/>
 <hr>
<BR/>
<BR/>
<a name="structure"><h4>Contact</h4></a>
<BR/>
This document was made by Manuel Ramirez and Vegard Nygaard.<BR/>
vegard.nygaard@medisin.uio.no<BR/>
Bioinformatics Core Facility<BR/>
Institute for Cancer Research<BR/>
Oslo University Hospital<BR/>
<BR/>

<BR/>

<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>
<BR/>


</div>
</body>
</html>
